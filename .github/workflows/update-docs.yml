

# this file was generated by https://github.com/nvfp/now-i-can-sleep

# WARNING: please use `nics update workflows` command if you want to edit this file,
#          instead of editing directly, some of them actually fine though to edit
#          directly, but some are not.
#          please read `https://nvfp.github.io/now-i-can-sleep/guide` to know more.


name: üåüRebuild docs

on:
  push:
    branches:
      - main

    paths:
      - 'docs/**'  # only rebuild docs webpage if docs/ folder is modified

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:

      - name: üìÇ Checkout main branch
        uses: actions/checkout@v3
        with:
          ref: main

      - name: Creating NICS working directory
        run: |
          echo "DEBUG: moving up.."
          cd ..
          echo "DEBUG: done, files in this dir ($(pwd)):"
          ls
          echo "-----------"

          echo "INFO: creating NICS working directory.."
          mkdir __nics_work_dir__
          echo "DEBUG: dir '__nics_work_dir__' is created."
          echo "DEBUG: files in this dir ($(pwd)):"
          ls
          echo "-----------"

          echo "DEBUG: go inside __nics_work_dir__"
          cd __nics_work_dir__
          echo "DEBUG: files in this dir ($(pwd)):"
          ls
          echo "-----------"
          
          echo "INFO: copying docs/ from main branch into __nics_work_dir__"
          cp -r ../mykit/docs/ .
          echo "INFO: copied!"
          echo "-----------"

          echo "DEBUG: files in this dir ($(pwd)):"
          ls
          echo "-----------"
      
      - name: Set up Pythonüêç
        uses: actions/setup-python@v2
        with:
          python-version: 3.8

      - name: Installing NICS
        run: |
          python -m pip install --upgrade pip
          pip install -U nics

      - name: üìÇ Checkout docs branch
        uses: actions/checkout@v3
        with:
          ref: docs

      - name: ‚öôÔ∏è Compiling...
        run: |
          echo "DEBUG: files in this dir ($(pwd)):"
          ls
          echo "-----------"

          echo "moving to NICS working dir"
          cd ..
          cd __nics_work_dir__
          echo "-----------"

          echo "DEBUG: files in this dir ($(pwd)):"
          ls
          echo "-----------"

          # echo "DEBUG: setup python venv"
          # python -m venv venv
          # echo "-----------"

          echo "DEBUG: run `nics _compile`"
          nics _compile "$(pwd)/docs" "$(pwd)/../mykit"
          echo "-----------"
          

      # - name: ‚ú® DEPLOY!
      #   run: |
      #     git config user.name "NICS"
      #     git config user.email "youremail@example.com"
      #     git add .
      #     git commit -m "testing Gaction: Add newfile.txt via workflow"
      #     git push